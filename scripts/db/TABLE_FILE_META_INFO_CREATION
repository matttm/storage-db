CREATE DATABASE IF NOT EXISTS STORAGE_DB;

CREATE TABLE STORAGE_DB.USER (
     USER_ID int NOT NULL AUTO_INCREMENT,
     FIRST_NAME varchar(256) NOT NULL,
     LAST_NAME varchar(256) NOT NULL,
     EMAIL varchar(256),
     CREATED_AT TIMESTAMP NOT NULL
         DEFAULT CURRENT_TIMESTAMP,
     UPDATED_AT TIMESTAMP NOT NULL
         DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
     PRIMARY KEY (USER_ID)
 );

INSERT INTO STORAGE_DB.USER
(FIRST_NAME, LAST_NAME, EMAIL)
VALUES
('Matt', 'Maloney', 'matttmaloney@gmail.com');

CREATE TABLE STORAGE_DB.USER_MATCH_PREFERENCE (
     USER_MATCH_PREFERENCE_ID int NOT NULL AUTO_INCREMENT,

     CREATED_AT TIMESTAMP NOT NULL
         DEFAULT CURRENT_TIMESTAMP,
     UPDATED_AT TIMESTAMP NOT NULL
         DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
     PRIMARY KEY (USER_MATCH_PREFERENCE_ID)
     FOREIGN KEY (USER_ID) REFERENCES STORAGE_DB.USER (USER_ID)
 );

CREATE TABLE STORAGE_DB.FILE_TYPE (
    FILE_TYPE_ID INT NOT NULL,
    FILE_TYPE_DESC varchar(1024) NOT NULL,
    PRIMARY KEY (FILE_TYPE_ID)
);

INSERT INTO STORAGE_DB.FILE_TYPE
(FILE_TYPE_ID, FILE_TYPE_DESC)
VALUES
(1, 'application/pdf');


CREATE TABLE STORAGE_DB.FILE_META_INFO (
    FILE_META_ID INT NOT NULL AUTO_INCREMENT,
    FILE_TYPE_CD INT NOT NULL,
    USER_ID INT NOT NULL,
    FILE_SIZE_KB INT NOT NULL,
    S3_BUCKET_NAME VARCHAR(1024),
    S3_OBJECT_NAME VARCHAR(1024),
    S3_OBJECT_KEY VARCHAR(1024),
    CREATED_AT TIMESTAMP NOT NULL
        DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP NOT NULL
        DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (FILE_META_ID),
    FOREIGN KEY (FILE_TYPE_CD) REFERENCES STORAGE_DB.FILE_TYPE (FILE_TYPE_ID),
    FOREIGN KEY (USER_ID) REFERENCES STORAGE_DB.USER (USER_ID)
);
